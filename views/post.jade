extends layout

block title
  | - Welcome

block appID
  - var appID = 'post'

block topspacer
  - var featImg = doc.get('post.featureImage').views.fullscreen.url || ''
  .page.page-full-image(style='background-image: url("#{featImg}");')
  .page.page-fixed-image

block app
  .page
    .container
      //-pre=JSON.stringify(doc,null,2)
      article

        .spacer-60

        h1=doc.getText('post.title')
        h3=doc.getText('post.excerpt')
        
        - var auths = doc.getAll('post.authors')[0]
        h5 di 
          if auths && auths.value.length > 0
            each author, authIndex in auths.value
              +printAuthor('postMeta', author.getLink('Autore'))
              if (authIndex !== (auths.value.length - 1))
                | , 
          else
            strong='GSO Company'

        .spacer-20

        .post
          !=doc.getStructuredText('post.content').asHtml(ctx.linkResolver)

        .spacer-20

        .meta
          .date=moment(doc.getDate('post.postDate')).format('DD/MM/YYYY')
          .reading-time=doc.getText('post.postReadingTime') + ' minuti'
          .categories
            - var cats = doc.getAll('post.categories')[0]
            if cats && cats.value.length > 0
              each category, catIndex in cats.value
                a(href=ctx.linkResolver(category.getLink('Categoria').document))
                  em=_.find(rawCategories, {'id': category.getLink('Categoria').id}).titolo
                if (catIndex !== (cats.value.length - 1))
                  | , 
            else
              em='Varie'

        if similars && similars.length > 0
          .spacer-60
          .pure-g.related-ones
            each post in similars
              div(class='pure-u-1 pure-u-md-1-#{similars.length}')
                h3
                  a(href=ctx.linkResolver(post))=post.getText('post.title')
                - var authsRelated = post.getAll('post.authors')[0]
                h5 di 
                  if authsRelated && authsRelated.value.length > 0
                    each author, authIndex in authsRelated.value
                      +printAuthor('postMeta', author.getLink('Autore'))
                      if (authIndex !== (authsRelated.value.length - 1))
                        | , 
                  else
                    strong='GSO Company'


        .spacer-40


        //- !{doc.asHtml(ctx.linkResolver)}

